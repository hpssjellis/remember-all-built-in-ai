<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Merged: Timeline + Chrome AI Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Vis.js Timeline Assets -->
  <script src="https://unpkg.com/vis-timeline@7.7.1/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <link
    href="https://unpkg.com/vis-timeline@7.7.1/styles/vis-timeline-graph2d.min.css"
    rel="stylesheet"
    type="text/css"
  />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #timeline {
      width: 95%;
      height: 300px;
      border: 1px solid #ccc;
      margin-top: 20px;
    }

    #custom-tooltip {
      position: absolute;
      display: none;
      max-width: 600px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 6px;
      z-index: 1000;
      white-space: normal;
      pointer-events: none;
      font-size: 14px;
    }
  </style>
</head>

<body>

  <!-- TIMELINE SECTION -->
  <h2>Vis.js Timeline with Custom Word-Wrapping Tooltips</h2>

  <!-- Entry Form -->
  <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 10px; max-width: 600px;">
    <label for="entryId" style="display: inline-block; width: 50px;">ID:</label>
    <input
      type="number"
      id="entryId"
      readonly
      style="width: 60px; margin-right: 20px;"
    />
    <label for="entryDate" style="display: inline-block; width: 50px;">Date:</label>
    <input
      type="datetime-local"
      id="entryDate"
      style="width: 220px; margin-right: 20px;"
    /><br /><br />

    <label for="entryContent" style="display: block; font-weight: bold;">Content:</label>
    <input
      type="text"
      id="entryContent"
      style="width: 100%; margin-bottom: 10px;"
      placeholder="Enter content"
    />

    <label for="entryLongDescription" style="display: block; font-weight: bold;">Long Description:</label>
    <textarea
      id="entryLongDescription"
      rows="4"
      style="width: 100%; margin-bottom: 10px;"
      placeholder="Enter long description"
    ></textarea>

    <button id="nextEntryBtn" style="margin-right: 10px;" onclick="autofillNextEntry()">Next Entry</button>
    <button id="addEntryBtn" onclick="addEntry(); populateSelectBox();">Add</button>
  </div>

  <div id="timeline"></div>
  <div id="custom-tooltip"></div>

  <!-- CHROME AI TOOL SECTION -->
  <hr style="margin: 40px 0;">
  <div style="font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px;">
    <h1 style="color: #4CAF50;">Chrome Built-in AI: Simple Prompt</h1>
    <p>This simple example shows how to use the <code>LanguageModel.prompt()</code> method, which sends a one-off text prompt to the built-in AI model and returns a single, complete response. It is a non-streaming operation.</p>

    <div style="margin-top: 20px;">
      <h2 style="margin-top: 0;">Statement Comparison Tool</h2>
      
    <!-- Select Box -->
    <select id="itemSelectBox" size="1" onChange="{ myLoadQuestion(this.value); }">
      <!-- Options will be populated dynamically -->
    </select><br>
     Question Hint: <input type=text id="myHint"> <br>

      
      <div style="display:block">
      <input type=text id="myPresentNumber"><br>
      <label for="storedStatement">Stored Statement hide later:</label>
      <textarea id="storedStatement" rows="3" placeholder="Enter the stored statement..."
        style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-top: 5px;"></textarea>
      </div>
      
      <label for="userTest">User Test:</label>
      <textarea id="userTest" rows="3" placeholder="Enter the user's test statement..."
        style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-top: 5px;"></textarea>

      <button id="myCheckButton" onclick="myCheckSimilarity()"
        style="display: block; width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; color: white; background-color: #4CAF50; border: none; border-radius: 5px; cursor: pointer;">Check
        Similarity</button>
    </div>

    <div style="margin-top: 20px;">
      <h2 style="margin-top: 0;">Status and Output</h2>
      <p id="myStatus" style="font-style: italic; color: #555;">Ready. Enter a prompt and click the button.</p>
      <textarea id="myOutput" rows="10" readonly
        style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #eee; box-sizing: border-box; margin-top: 10px;"></textarea>
    </div>

    <hr style="margin: 40px 0;">

    <div>
      <h2>A Note on Chrome Flags</h2>
      <p>To use this feature, you must have the "Enable built-in AI" flag enabled in Chrome. Open a new tab, paste the link below, press Enter, enable the flag, and then restart Chrome.</p>
      <input type="text" id="flagsLink" value="chrome://flags/#enable-built-in-ai" readonly
        style="width: 100%; padding: 8px; border: 1px solid #ccc; background-color: #f0f0f0; cursor: pointer;"
        onclick="myCopyFlagsLink()">
      <br>
      <button onclick="myCopyFlagsLink()" style="margin-top: 10px; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Copy Link & Open New Tab</button>
    </div>

    <hr style="margin: 40px 0;">

    <div>
      <h2>My GitHub</h2>
      <p>You can find more of my work on my <a href="https://github.com/hpssjellis"> hpssjellis </a> GitHub page:</p>
      <p> By Jeremy Ellis <a href="https://ca.linkedin.com/in/jeremy-ellis-4237a9bb"> LinkedIn </a><br></p>
    </div>
  </div>

  <!-- COMBINED SCRIPTS -->
  <script>
    // --- Vis.js Timeline Script ---
    const container = document.getElementById('timeline');
    const tooltip = document.getElementById('custom-tooltip');
    const itemSelectBox = document.getElementById('itemSelectBox');

    
    const items = new vis.DataSet([
      {
        id: 1,
        content: 'Cookie',
        start: '2025-07-26T10:00:00',
        longDescription: 'chocolat, butter, granola, peanut butter, cooked',
        myOld: '2025-09-29T10:00:00',
      },
      {
        id: 2,
        content: 'DNA',
        start: '2025-05-27T14:00:00',
        longDescription: 'Genetic code that is the base for life',
        myOld:'2025-09-29T14:00:00',
      },
      {
        id: 3,
        content: '3+7',
        start: '2025-01-28T09:00:00',
        longDescription: '10',
        myOld:'2025-09-30T09:00:00',
      },
    ]);

    const timeline = new vis.Timeline(container, items, {
      type: 'box',
      tooltip: {
        followMouse: false,
      },
    });

    timeline.on('itemover', function (props) {
      const item = items.get(props.item);
      if (item && item.longDescription) {
        tooltip.innerHTML = item.longDescription.replace(/\n/g, '<br>');
        tooltip.style.display = 'block';
      }
    });

    timeline.on('itemout', function () {
      tooltip.style.display = 'none';
    });

    container.addEventListener('mousemove', function (e) {
      tooltip.style.left = e.pageX + 10 + 'px';
      tooltip.style.top = e.pageY + 10 + 'px';
    });

    const entryIdInput = document.getElementById('entryId');
    const entryDateInput = document.getElementById('entryDate');
    const entryContentInput = document.getElementById('entryContent');
    const entryLongDescriptionInput = document.getElementById('entryLongDescription');

    function getNextId() {
      const allIds = items.getIds();
      return allIds.length ? Math.max(...allIds) + 1 : 1;
    }

    function getCurrentDateTimeLocal() {
      const now = new Date();
      now.setSeconds(0, 0);
      const offset = now.getTimezoneOffset();
      const localDate = new Date(now.getTime() - offset * 60000);
      return localDate.toISOString().slice(0, 16);
    }

    function autofillNextEntry() {
      entryIdInput.value = getNextId();
      entryDateInput.value = getCurrentDateTimeLocal();
      entryContentInput.value = '';
      entryLongDescriptionInput.value = '';
    }

    function addEntry() {
      const id = Number(entryIdInput.value);
      const content = entryContentInput.value.trim();
      const longDescription = entryLongDescriptionInput.value.trim();
      const dateTimeLocal = entryDateInput.value;
      const myOld = entryDateInput.value;

      if (!content) {
        alert('Please enter content.');
        return;
      }
      if (!dateTimeLocal) {
        alert('Please enter a valid date and time.');
        return;
      }

      const isoString = new Date(dateTimeLocal).toISOString();

      if (items.get(id)) {
        alert('ID already exists. Click "Next Entry" to get a new ID.');
        return;
      }

      items.add({
        id,
        content,
        start: isoString,
        longDescription,
        myOld,
      });

      autofillNextEntry();
    }

    autofillNextEntry();

    // --- Chrome Built-in AI Tool Script ---
    let myLanguageModelSession = null;
    let myTimerInterval = null;

    function myStartTimer() {
      let mySeconds = 0;
      myStatus.textContent = "Working... 0s";
      myTimerInterval = setInterval(() => {
        mySeconds++;
        myStatus.textContent = `Working... ${mySeconds}s`;
      }, 1000);
    }

    function myStopTimer(myMessage) {
      if (myTimerInterval) {
        clearInterval(myTimerInterval);
        myTimerInterval = null;
      }
      myStatus.textContent = myMessage;
    }

    async function myCheckSimilarity() {
      const storedStatement = document.getElementById('storedStatement');
      const userTest = document.getElementById('userTest');
      const myOutput = document.getElementById('myOutput');
      const myStatus = document.getElementById('myStatus');
      const myCheckButton = document.getElementById('myCheckButton');

      myCheckButton.disabled = true;
      myCheckButton.style.backgroundColor = '#ccc';

      try {
        if (!('LanguageModel' in window)) {
          myStopTimer("Error: LanguageModel API not available. Make sure you are using a compatible Chrome version with the 'Enable built-in AI' flag turned on.");
          return;
        }

        myStartTimer();
        myOutput.value = "";

        if (!myLanguageModelSession) {
          myStatus.textContent = 'Creating AI session...';
          myLanguageModelSession = await LanguageModel.create();
          myStatus.textContent = 'Session created. Sending prompt...';
        }

        const storedValue = storedStatement.value.trim();
        const userValue = userTest.value.trim();

        if (!storedValue || !userValue) {
          myStopTimer('Please fill in both text boxes.');
          return;
        }

      //  const myPrompt = `Are these two statements loosely the same? Ignore case. Answer only with "same" or "different".\nStatement 1: ${storedValue}\nStatement 2: ${userValue}`;
        const myPrompt = `Compare the meaning of the following two statements and determine if they express the same general idea. Ignore differences in letter casing (e.g., uppercase vs lowercase). Only respond with one word: "same" if they mean the same thing, or "different" if they do not. Do not explain your answer.\nStatement 1: ${storedValue}\nStatement 2: ${userValue}`;

        const myResponse = await myLanguageModelSession.prompt(myPrompt);
        myOutput.value = myResponse.trim().toLowerCase() === 'same' ? 'Same' : 'Different';
        myStopTimer("Comparison complete!");

      } catch (myError) {
        myStopTimer("An error occurred. Check the console for details.");
        console.error("Error:", myError);
      } finally {
        myCheckButton.disabled = false;
        myCheckButton.style.backgroundColor = '#4CAF50';
      }
      myUpdateMemory();

      
    }

    function myCopyFlagsLink() {
      const myFlagsInput = document.getElementById('flagsLink');
      myFlagsInput.select();
      myFlagsInput.setSelectionRange(0, 99999);
      document.execCommand('copy');
      window.open('about:blank', '_blank');
    }


// ✅ Function to populate the select box
    function populateSelectBox() {
      const allItems = items.get();
      itemSelectBox.innerHTML = ''; // Clear previous options

      if (allItems.length === 0) {
        const option = document.createElement('option');
        option.textContent = 'No items available';
        itemSelectBox.appendChild(option);
        return;
      }

      allItems.forEach(item => {
        const option = document.createElement('option');
        option.value = item.id;
        option.textContent = `#${item.id} - ${item.content}`;
        itemSelectBox.appendChild(option);
      });
    }

function myLoadQuestion(myPassedValue) {
  console.log('myPassedValue')
  console.log(myPassedValue)
  const myItem = items.get(parseInt(myPassedValue));  // id needs to be an integer
  console.log('myItem');
  console.log(myItem);
  if (myItem) {
    document.getElementById('storedStatement').value = myItem.longDescription || '';
    document.getElementById('myHint').value = myItem.content || '';
    document.getElementById('userTest').value = '';
    document.getElementById('myPresentNumber').value = myPassedValue;
  } else {
    console.warn('Item not found with ID:', myPassedValue);
  }
}


    function myUpdateMemory(){
     const myQuestionNumber  =  document.getElementById('myPresentNumber').value 
     const myItem2 = items.get(parseInt(myQuestionNumber));  // id needs to be an integer
      if (myItem2) {

       console.log(myQuestionNumber)
       console.log(myQuestionNumber)
        
        console.log('myItem2')
        console.log(myItem2)
        const now = new Date();
        console.log('now')
        console.log(now)
        console.log('myItem2.start')
        console.log(myItem2.start)
        const myOldDateTime = isoToMillis(myItem2.start)
        console.log('myOldDateTime')
        console.log(myOldDateTime)
        
        const myDuration = now - myOldDateTime
        console.log('myDuration')
        console.log(myDuration)
        
        const NextDateTime = myOldDateTime + now
        console.log('NextDateTime')
        console.log(NextDateTime)

       const myIsoDate = millisToIso(NextDateTime)
       console.log('myIsoDate')
       console.log(myIsoDate)

        
        myItem2.myOld = myItem2.start  // store the old time
        myItem2.start = myIsoDate; // update start time to current time
        items.update(myItem2); // update the dataset
       // alert('Item 2 time updated to now.');
        console.log('updated  myItem2')
        console.log(myItem2)
      } else {
        alert('Item 2 not found.');
      }
    }


    function isoToMillis(isoString) {
      return new Date(isoString).getTime();
    }
    
    /**
     * Convert milliseconds since epoch to an ISO 8601 datetime string
     * @param {number} millis - e.g., 1759165800000
     * @returns {string} - ISO string in UTC (e.g., "2025-09-29T14:30:00.000Z")
     */
    function millisToIso(millis) {
      return new Date(millis).toISOString();
    }



    
    
    // fill select  box with items
    populateSelectBox()
  </script>

</body>
</html>
